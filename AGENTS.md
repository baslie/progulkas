# Руководство по разработке проекта «Маршруты Прогулки»

Этот документ задаёт требования к продукту, техстеку и процессу работы. Любое изменение в репозитории должно подтверждать соответствие этим правилам.

---

## 1. Цели проекта и роли
- **Scrum Master & Product Owner**: вы совмещаете обе роли и строго следуете данному документу.
- Поддерживайте итеративный подход: завершайте текущий блок (эпик) полностью, прежде чем переходить к следующему.
- Все решения об архитектуре и UX принимаются в рамках описанных ниже стандартов качества.

---

## 2. Технологический стек
| Подсистема | Требования |
|------------|------------|
| **Клиент** | Next.js (App Router) + TypeScript |
| **Стили** | Tailwind CSS, shadcn/ui, дизайн-токены из `docs/shadcn-ui-theme.css` |
| **Бэкенд** | Prisma ORM с PostgreSQL |
| **Аутентификация** | NextAuth.js (Email/пароль + Google OAuth, подтверждение email) |
| **Карты** | Leaflet или MapLibre GL JS, OSM-тайлы |
| **Треки** | Импорт/экспорт GPX, KML, GeoJSON (FIT опционально) |
| **Медиа** | Sharp для изображений, Node-Canvas или Puppeteer для превью карт |
| **PDF** | `html-pdf-node` или аналог |
| **Инфраструктура** | Docker/Docker Compose для разработки и деплоя |
| **SEO/Аналитика** | JSON-LD, Open Graph, Яндекс.Метрика, Google Analytics |

---

## 3. Рабочий процесс
1. Перед началом работы обновите статус в чек-листах эпиков.
2. Работайте по эпикам из бэклога строго по порядку; внутри эпика выполняйте задачи сверху вниз.
3. По завершении задачи:
   - Обновите соответствующий пункт чек-листа.
   - Зафиксируйте изменения в журнале прогресса со ссылкой на PR/коммит.
4. Перед переходом к следующему эпику убедитесь, что все задачи текущего эпика выполнены и задокументированы.
5. В конце каждого эпика запустите обязательный набор тестов (lint, unit, integration/e2e при наличии) и задокументируйте результаты в журнале.

---

## 4. Чек-листы эпиков
Отмечайте галочкой (`[x]`) завершённые задачи, `[ ]` — незавершённые. Не меняйте порядок элементов.

### Эпик 1. Базовая инфраструктура и среда
- [x] 1.1 Настройка проекта (Next.js + TS, ESLint, Prettier)
- [x] 1.2 Настройка БД и ORM (PostgreSQL, Prisma, первая миграция)
- [x] 1.3 Настройка стилизации (Tailwind, shadcn/ui, адаптивный макет)
- [x] 1.4 Система аутентификации (NextAuth.js: Email/пароль, Google OAuth, подтверждение email)
- [x] 1.5 Ролевая модель (Пользователь, Автор, Админ)
- [x] 1.6 Развертывание (Docker/Docker Compose для dev/staging)
- [x] Тесты эпика 1 (lint + unit/integration)

### Эпик 2. Ядро маршрутов и каталог
- [x] 2.1 Схема БД для маршрутов
- [x] 2.2 Карточка маршрута (главная)
- [x] 2.3 Страница каталога (только карточки)
- [x] 2.4 Основная фильтрация (сложность, длина, длительность, «для кого подходит»)
- [x] 2.5 Живой поиск (PostgreSQL FTS)
- [x] Тесты эпика 2 (lint + unit/integration)

### Эпик 3. Просмотр маршрута и карта
- [x] 3.1 Страница просмотра маршрута (дизайн)
- [x] 3.2 Рендеринг описания (Markdown)
- [x] 3.3 Блоки информации (транспорт, риски и т.д.)
- [x] 3.4 Динамическая карта (OSM, трек, POI)
- [x] 3.5 Скачивание трека (GPX, KML, GeoJSON)
- [x] 3.6 Печать в PDF
- [x] Тесты эпика 3 (lint + unit/integration/e2e)

### Эпик 4. Создание и управление маршрутами
- [x] 4.1 Админка (скелет)
- [x] 4.2 Форма создания маршрута (черновики, предпросмотр)
- [x] 4.3 Загрузка и конвертация треков
- [x] 4.4 Обработка фото (resize, compress)
- [x] 4.5 Генерация превью-картинки трека
- [x] 4.6 CRUD точек интереса
- [x] 4.7 Поддержка нескольких авторов
- [x] Тесты эпика 4 (lint + unit/integration/e2e)

### Эпик 5. Социальные функции и SEO
- [ ] 5.1 Рейтинг и оценка
- [ ] 5.2 Система комментариев (ветки)
- [ ] 5.3 Модерация комментариев и антиспам
- [ ] 5.4 Уведомления
- [ ] 5.5 SEO-оптимизация (JSON-LD, Open Graph, ЧПУ)
- [ ] 5.6 Кнопки шеринга
- [ ] Тесты эпика 5 (lint + unit/integration/e2e)

### Эпик 6. Финализация и запуск
- [ ] 6.1 Юридические страницы
- [ ] 6.2 Баннер cookies
- [ ] 6.3 Страница «Поддержать проект»
- [ ] 6.4 Интеграция аналитики
- [ ] 6.5 Аудит-лог
- [ ] 6.6 Финальное тестирование (адаптивность, контент)
- [ ] Тесты эпика 6 (lint + unit/integration/e2e)

---

## 5. Журнал прогресса
Фиксируйте каждую значимую итерацию в формате:
```
Эпик/Задача — Статус — Ссылка на PR/коммит — Краткие заметки — Результаты тестов (если применимо)
```

---

## 6. Критерии качества
- Поддержка мобильных, планшетов и десктопов (mobile-first).
- Единый визуальный стиль на основе компонентов shadcn/ui.
- Покрытие тестами ключевых пользовательских сценариев (unit, integration, e2e).
- Интерфейс полностью на русском, оставляйте возможность локализации.
- Соблюдайте требования доступности (контрастность, aria-атрибуты, клавиатурная навигация).

---

## 7. Процесс ревью и тестирования
1. Перед PR выполните автоматические проверки (lint, тесты, типизацию).
2. В описании PR указывайте задачи и ссылки на чек-листы.
3. После ревью обновляйте чек-листы и журнал прогресса.
4. Выполняйте ручное тестирование на ключевых устройствах и разрешениях.
5. По завершении каждого эпика прикладывайте отчёт о пройденных тестах в журнал прогресса.

**Следуйте данному руководству при любых изменениях проекта.**
