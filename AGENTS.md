# Руководство по разработке "Томская прогулка"

## 1. Роли и принципы
- **Scrum Master & Product Owner**: Вы следуете этому документу как единственному источнику требований.
- Соблюдайте итеративную разработку: не переходите к следующему блоку, пока текущий не завершён и не отмечен.
- Все изменения должны соответствовать стандартам качества, описанным ниже.

## 2. Технологический стек (обязателен ко внедрению)
- **Ядро**: Next.js (App Router) + TypeScript.
- **Стили**: Tailwind CSS, shadcn/ui. Используйте дизайн-токены из `docs/shadcn-ui-theme.css` как эталон.
- **Бэкенд**: Prisma ORM c PostgreSQL.
- **Аутентификация**: NextAuth.js (Email/пароль + Google OAuth, подтверждение email).
- **Карты**: Leaflet или MapLibre GL JS с OSM-тайлами.
- **Файлы треков**: Поддержка импорта/экспорта GPX, KML, GeoJSON (FIT опционален).
- **Медиа**: Sharp для обработки изображений, Node-Canvas или Puppeteer для генерации превью-карт.
- **PDF**: `html-pdf-node` или аналог.
- **Инфраструктура**: Docker/Docker Compose для локальной разработки и деплоя.
- **SEO/Аналитика**: JSON-LD, Open Graph, Яндекс.Метрика, Google Analytics.

## 3. Гайд по разработке
1. Перед началом задачи обновите раздел статуса в этом файле.
2. Выполняйте задачи строго по блокам (эпику) из Бэклога.
3. Внутри блока соблюдайте порядок задач сверху вниз.
4. После завершения каждой задачи:
   - Обновите статус в чек-листе.
   - Приложите ссылки на релевантные коммиты/PR в журнале ниже.
5. Перед переходом к следующему блоку убедитесь, что все задачи текущего блока выполнены и протестированы.

## 4. Чек-листы эпиков
Отмечайте галочкой (`[x]`) завершённые задачи, `[ ]` — незавершённые. Не изменяйте порядок.

### Эпик 1: Базовая инфраструктура и среда
- [ ] 1.1 Настройка проекта (Next.js + TS, ESLint, Prettier)
- [ ] 1.2 Настройка БД и ORM (PostgreSQL, Prisma, первая миграция)
- [ ] 1.3 Настройка стилизации (Tailwind, shadcn/ui, адаптивный макет)
- [ ] 1.4 Система аутентификации (NextAuth.js: Email/пароль, Google OAuth, подтверждение email)
- [ ] 1.5 Ролевая модель (Пользователь, Автор, Админ)
- [ ] 1.6 Развертывание (Docker/Docker Compose для dev/staging)

### Эпик 2: Ядро маршрутов и каталог
- [ ] 2.1 Схема БД для маршрутов
- [ ] 2.2 Карточка маршрута (главная)
- [ ] 2.3 Страница каталога (только карточки)
- [ ] 2.4 Основная фильтрация (сложность, длина, длительность, «для кого подходит»)
- [ ] 2.5 Живой поиск (PostgreSQL FTS)

### Эпик 3: Просмотр маршрута и карта
- [ ] 3.1 Страница просмотра маршрута (дизайн)
- [ ] 3.2 Рендеринг описания (Markdown)
- [ ] 3.3 Блоки информации (транспорт, риски и т.д.)
- [ ] 3.4 Динамическая карта (OSM, трек, POI)
- [ ] 3.5 Скачивание трека (GPX, KML, GeoJSON)
- [ ] 3.6 Печать в PDF

### Эпик 4: Создание и управление маршрутами
- [ ] 4.1 Админка (скелет)
- [ ] 4.2 Форма создания маршрута (черновики, предпросмотр)
- [ ] 4.3 Загрузка и конвертация треков
- [ ] 4.4 Обработка фото (resize, compress)
- [ ] 4.5 Генерация превью-картинки трека
- [ ] 4.6 CRUD точек интереса
- [ ] 4.7 Поддержка нескольких авторов

### Эпик 5: Социальные функции и SEO
- [ ] 5.1 Рейтинг и оценка
- [ ] 5.2 Система комментариев (ветки)
- [ ] 5.3 Модерация комментариев и антиспам
- [ ] 5.4 Уведомления
- [ ] 5.5 SEO-оптимизация (JSON-LD, Open Graph, ЧПУ)
- [ ] 5.6 Кнопки шеринга

### Эпик 6: Финализация и запуск
- [ ] 6.1 Юридические страницы
- [ ] 6.2 Баннер cookies
- [ ] 6.3 Страница «Поддержать проект»
- [ ] 6.4 Интеграция аналитики
- [ ] 6.5 Аудит-лог
- [ ] 6.6 Финальное тестирование (адаптивность, контент)

## 5. Журнал прогресса
Фиксируйте каждую значимую итерацию:
```
YYYY-MM-DD — Эпик/Задача — Статус — Ссылка на PR/коммит — Краткие заметки
```

## 6. Критерии качества
- Поддержка мобильных, планшетов и десктопов (mobile-first).
- Согласованность UI: используйте единый набор компонентов shadcn/ui.
- Обеспечьте покрытие тестами ключевых пользовательских сценариев (unit/integration/e2e по необходимости).
- Все тексты интерфейса на русском, поддерживайте i18n-готовность.
- Соблюдайте принципы доступности (a11y): контраст, aria-атрибуты, навигация с клавиатуры.

## 7. Процесс ревью и тестирования
1. Перед PR выполните автоматические проверки (lint, тесты, типизация).
2. PR должен содержать описание задачи, ссылку на чек-лист и отмеченные пункты.
3. После ревью обновите статус чек-листа и журнала.
4. Протестируйте функционал вручную на ключевых устройствах/разрешениях.

Следуйте этому документу при каждом изменении проекта.
