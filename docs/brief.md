## 1. Интервью: сайт «Маршруты Прогулки»

---

**Исполнитель:** Расскажите, кто будет вашей главной аудиторией?

**Заказчик:** Аудитория у нас широкая. Это и туристы, и местные жители, и семейные люди, и бегуны, и велосипедисты. Любой может посмотреть маршруты. Хорошо было бы сделать графу «для кого подходит»: пешком, для бега, семейный отдых, вело и так далее.

---

**Исполнитель:** На каких устройствах люди будут пользоваться сайтом?

**Заказчик:** Думаю, в основном на мобильных, но сайт должен хорошо работать и на планшетах, и на десктопах. Оффлайн-печать нам не нужна.

---

**Исполнитель:** Какие главные задачи для пользователя?

**Заказчик:** Чтобы быстро и удобно найти маршрут, оценить его, прочитать комментарии и, если хочется, оставить свой.

---

**Исполнитель:** Нужна ли карта уже на главной странице?

**Заказчик:** На главной странице только карточки маршрутов с картинкой-превью, которая генерируется из трека. А динамическая карта — только внутри карточки маршрута.

---

**Исполнитель:** Хотите ли подборки вроде «для детей» или «на выходные»?

**Заказчик:** Лучше сделать фильтрацию прямо на главной.

---

**Исполнитель:** Нужен ли блок новостей?

**Заказчик:** Пока нет, только маршруты.

---

**Исполнитель:** А рейтинги и оценки маршрутов?

**Заказчик:** Да, нужны.

---

**Исполнитель:** Избранное, подписки, уведомления?

**Заказчик:** Избранное и подписки не нужны. Но уведомления — например, о комментариях на мой маршрут или модерации — будут полезны.

---

**Исполнитель:** В каком регионе запускаетесь?

**Заказчик:** Мы стартуем в Томске. Проект называется «Томская прогулка».

---

**Исполнитель:** Какие фильтры для поиска нужны?

**Заказчик:** Сложность, длина, длительность. Но без лишней детализации — оставим простые и понятные фильтры.

---

**Исполнитель:** Какие форматы треков будем поддерживать?

**Заказчик:** GPX, KML, GeoJSON. FIT — под вопросом. Пользователь должен загружать в любом из этих форматов, а сайт конвертирует во все остальные.

---

**Исполнитель:** Нужна ли статистика по треку (набор высоты, макс. точка)?

**Заказчик:** Нет, не обязательно.

---

**Исполнитель:** А кнопка «скачать трек»?

**Заказчик:** Да, обязательно. В нескольких форматах.

---

**Исполнитель:** Как насчёт слоёв карты, рельефа, переключателей?

**Заказчик:** Если виджет карт это позволяет — используем. Если нет, то и не надо.

---

**Исполнитель:** Можно использовать бесплатные OSM-тайлы?

**Заказчик:** Да, именно их и хотим.

---

**Исполнитель:** Оффлайн-режим, печать?

**Заказчик:** Оффлайн не нужен. Но печать в PDF — да, это будет полезно.

---

**Исполнитель:** Какой должна быть превью-картинка трека?

**Заказчик:** Стандартные размеры для сайта и соцсетей. Просто линия трека на карте, без легенды и значков. В едином стиле, с одинаковым цветом.

---

**Исполнитель:** Какие точки интереса будут на маршруте?

**Заказчик:** Виды, вода, кафе, туалеты, транспорт. У каждой точки — иконка. Фотогалерея не нужна, но фотогалерея для маршрута в целом должна быть.

---

**Исполнитель:** Какой формат длинного описания маршрута?

**Заказчик:** Markdown с форматированием.

---

**Исполнитель:** А блоки «как добраться», «как уехать»?

**Заказчик:** Свободный текст.

---

**Исполнитель:** Интересные факты, риски, предупреждения?

**Заказчик:** Да, должны быть отдельные поля. Например, про запреты на костры, клещей, животных.

---

**Исполнитель:** Кто может создавать маршруты?

**Заказчик:** Пока только редакторы. Но в будущем хотим открыть для авторов с модерацией.

---

**Исполнитель:** Публикация маршрутов сразу или через модерацию?

**Заказчик:** Сразу, но с возможностью черновика и предпросмотра.

---

**Исполнитель:** Нужна ли поддержка нескольких авторов у маршрута?

**Заказчик:** Да, это важно.

---

**Исполнитель:** Как будут устроены комментарии?

**Заказчик:** Храним у себя. С модерацией, антиспамом. Ссылки разрешены только как текст. Комментарии должны поддерживать ветки и ответы. Должна быть возможность пожаловаться. И оценки маршрутов — отдельно от комментариев.

---

**Исполнитель:** Аутентификация: какие способы входа нужны?

**Заказчик:** Email+пароль, магическая ссылка и вход через Google. С подтверждением email.

---

**Исполнитель:** Какие роли пользователей будут?

**Заказчик:** Три роли: пользователь (комментирует), автор (создаёт маршруты), админ (управляет всем).

---

**Исполнитель:** Админка какая нужна?

**Заказчик:** Встроенная в сайт. Разделы: маршруты, треки, точки интереса, пользователи, комментарии, теги, медиа. Нужен аудит-лог и предпросмотр превью.

---

**Исполнитель:** Какой поиск нужен?

**Заказчик:** Живой поиск по названию, тексту и тегам. Карта-каталог не нужна.

---

**Исполнитель:** А SEO и шаринг?

**Заказчик:** Обязательно. JSON-LD, человекопонятные URL (но латиницей), предпросмотр для соцсетей.

---

**Исполнитель:** Лицензии и авторские права?

**Заказчик:** Контент принадлежит авторам. Лицензия — Creative Commons.

---

**Исполнитель:** Кто будет наполнять контентом сайт?

**Заказчик:** Редакторы.

---

**Исполнитель:** Аналитика?

**Заказчик:** Яндекс.Метрика и Гугл.Аналитика.

---

**Исполнитель:** Какие ограничения по фото и трекам?

**Заказчик:** Фото до 3 МБ, максимум 1920 пикселей по длинной стороне. Автоматическое сжатие обязательно.

---

**Исполнитель:** Нужны ли пуши, оффлайн-режим, мультиязычность?

**Заказчик:** Нет. Язык только русский. Единицы измерения — километры.

---

**Исполнитель:** Импорт/экспорт маршрутов?

**Заказчик:** Экспорт нужен (GPX, KML, GeoJSON). Импорт из сторонних сервисов — не нужен.

---

**Исполнитель:** Шеринг?

**Заказчик:** Да, нужны кнопки для соцсетей.

---

**Исполнитель:** Страница «Поддержать проект»?

**Заказчик:** Да, нужна.

---

**Исполнитель:** Юридические документы?

**Заказчик:** Обязательно: правила, политика приватности, куки-баннер и отказ от ответственности.

---

**Исполнитель:** Что входит в MVP?

**Заказчик:** Всё, что я перечислил выше. Маршруты добавим уже ближе к запуску — можно начать с тестового маршрута.

---

## 2. Стек технологий

### 1. Фреймворк и Frontend (Лицевая часть)

1.  **Next.js (React Framework):** Используется как основной full-stack фреймворк. Он обеспечивает Server-Side Rendering (SSR) и Static Site Generation (SSG), что **критически важно для SEO** и быстрого отображения карточек маршрутов. Также позволяет создавать API-маршруты для бэкенд-логики.
2.  **TypeScript:** Применяется для всего кода (фронтенд и бэкенд). Обеспечивает строгую типизацию, что повышает надёжность и упрощает поддержку сложного проекта с разными ролями, данными и бизнес-логикой.
3.  **Tailwind CSS:** Используется для стилизации. Позволяет быстро создать полностью **адаптивный дизайн** (Mobile-First), который отлично выглядит на всех устройствах (смартфоны, планшеты, десктопы), как того требует заказчик.
4.  **shadcn/ui:** Набор готовых, доступных (accessible) и кастомизируемых компонентов на базе Tailwind. Ускорит разработку, обеспечит профессиональный вид и поможет быстро собрать сложный интерфейс, включая фильтры, админку и формы.

### 2. Backend и Данные (Серверная логика)

1.  **PostgreSQL (База Данных):** Выбран для локальной разработки и продакшена. Это надёжная, масштабируемая реляционная база данных, которая отлично справляется с высокой конкурентностью (комментарии, одновременное редактирование) и транзакциями. В дальнейшем легко интегрируется с расширением **PostGIS** для продвинутой работы с геоданными.
2.  **Prisma (ORM):** Объектно-реляционное отображение, которое упрощает взаимодействие с PostgreSQL. Позволяет описывать схему БД в TypeScript и проводить миграции, обеспечивая высокий уровень безопасности и типизации запросов.
3.  **NextAuth.js (Auth.js):** Стандартная библиотека для аутентификации в Next.js. Позволяет легко реализовать требуемые методы входа: **Email/пароль**, **Магическая ссылка** (беспарольный вход) и **Google OAuth**.
4.  **Next.js API Routes / Server Actions:** Используются для реализации всей серверной логики: обработка данных, модерация, управление ролями (**Пользователь, Автор, Админ**), система комментариев (ветвление, антиспам, жалобы) и ведение аудит-лога.

### 3. Геоданные и Обработка Медиа

1.  **Leaflet (или MapLibre GL JS):** Лёгкая JavaScript-библиотека для отображения динамических карт с использованием **бесплатных OSM-тайлов**. Идеальна для отрисовки треков и точек интереса (POI) внутри карточки маршрута.
2.  **`togeojson` / `gpx-js`:** Node.js-библиотеки для серверного **парсинга и конвертации** загруженных пользователями файлов треков (**GPX, KML, GeoJSON**). Конвертируют эти форматы в унифицированный GeoJSON для хранения в БД и последующего экспорта.
3.  **Sharp:** Высокопроизводительная библиотека для работы с изображениями на сервере. **Обязательна** для автоматической обработки всех загружаемых фото: сжатия, изменения размеров (**до 1920px по длинной стороне**) и ограничения по объёму (до 3 МБ).
4.  **Node-Canvas / Puppeteer:** Инструмент для **серверной генерации превью-картинок**. Позволяет программно отрисовать линию трека на карте (на виртуальном холсте) и сохранить результат как статичное изображение. Это необходимо для карточек на главной и для **SEO/Open Graph** превью в соцсетях.
5.  **`html-pdf-node`:** Библиотека для **генерации PDF-файла** из HTML-разметки страницы маршрута. Позволяет реализовать требуемую функцию печати маршрута.

### 4. Дополнительные Инструменты

1.  **React-Markdown:** Библиотека для безопасного рендеринга пользовательского контента. Используется для отображения длинных описаний маршрутов, написанных в формате **Markdown**.
2.  **PostgreSQL Full-Text Search:** Используется встроенная функция базы данных для быстрого и **живого поиска** маршрутов по названию, описанию и тегам.
3.  **SEO & Sharing (Next.js Features):** Использование встроенных возможностей фреймворка для настройки **JSON-LD** (структурированные данные), **Open Graph** метатегов и генерации **человекопонятных URL (ЧПУ)** для максимальной поисковой оптимизации.
4.  **Yandex.Metrika и Google Analytics:** Стандартные JavaScript-счётчики, интегрируемые в корневой шаблон Next.js для сбора аналитики.
5.  **Docker / Docker Compose:** Рекомендуется для упрощения локальной разработки. Позволяет легко и консистентно настроить окружение, запустив Next.js и **PostgreSQL** в контейнерах.

---

## 3. Стили shadCN UI

:root {
  --background: oklch(1.0000 0 0);
  --foreground: oklch(0.1884 0.0128 248.5103);
  --card: oklch(0.9784 0.0011 197.1387);
  --card-foreground: oklch(0.1884 0.0128 248.5103);
  --popover: oklch(1.0000 0 0);
  --popover-foreground: oklch(0.1884 0.0128 248.5103);
  --primary: oklch(0.5857 0.2236 31.4889);
  --primary-foreground: oklch(1.0000 0 0);
  --secondary: oklch(0.1884 0.0128 248.5103);
  --secondary-foreground: oklch(1.0000 0 0);
  --muted: oklch(0.9222 0.0013 286.3737);
  --muted-foreground: oklch(0.1884 0.0128 248.5103);
  --accent: oklch(0.9392 0.0166 250.8453);
  --accent-foreground: oklch(0.5857 0.2236 31.4889);
  --destructive: oklch(0.5857 0.2236 31.4889);
  --destructive-foreground: oklch(1.0000 0 0);
  --border: oklch(0.9317 0.0118 231.6594);
  --input: oklch(0.9809 0.0025 228.7836);
  --ring: oklch(0.5857 0.2236 31.4889);
  --chart-1: oklch(0.6723 0.1606 244.9955);
  --chart-2: oklch(0.6907 0.1554 160.3454);
  --chart-3: oklch(0.8214 0.1600 82.5337);
  --chart-4: oklch(0.7064 0.1822 151.7125);
  --chart-5: oklch(0.5919 0.2186 10.5826);
  --sidebar: oklch(0.9784 0.0011 197.1387);
  --sidebar-foreground: oklch(0.1884 0.0128 248.5103);
  --sidebar-primary: oklch(0.5857 0.2236 31.4889);
  --sidebar-primary-foreground: oklch(1.0000 0 0);
  --sidebar-accent: oklch(0.9392 0.0166 250.8453);
  --sidebar-accent-foreground: oklch(0.5857 0.2236 31.4889);
  --sidebar-border: oklch(0.9271 0.0101 238.5177);
  --sidebar-ring: oklch(0.5857 0.2236 31.4889);
  --font-sans: Open Sans, ui-sans-serif, sans-serif, system-ui;
  --font-serif: Noto Serif, ui-serif, serif;
  --font-mono: IBM Plex Mono, ui-monospace, monospace;
  --radius: 1.3rem;
  --shadow-2xs: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00);
  --shadow-xs: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00);
  --shadow-sm: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00), 0px 1px 2px -1px hsl(202.8169 89.1213% 53.1373% / 0.00);
  --shadow: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00), 0px 1px 2px -1px hsl(202.8169 89.1213% 53.1373% / 0.00);
  --shadow-md: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00), 0px 2px 4px -1px hsl(202.8169 89.1213% 53.1373% / 0.00);
  --shadow-lg: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00), 0px 4px 6px -1px hsl(202.8169 89.1213% 53.1373% / 0.00);
  --shadow-xl: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00), 0px 8px 10px -1px hsl(202.8169 89.1213% 53.1373% / 0.00);
  --shadow-2xl: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00);
  --tracking-normal: 0em;
  --spacing: 0.25rem;
}

.dark {
  --background: oklch(0 0 0);
  --foreground: oklch(0.9328 0.0025 228.7857);
  --card: oklch(0.2097 0.0080 274.5332);
  --card-foreground: oklch(0.8853 0 0);
  --popover: oklch(0 0 0);
  --popover-foreground: oklch(0.9328 0.0025 228.7857);
  --primary: oklch(0.5857 0.2236 31.4889);
  --primary-foreground: oklch(1.0000 0 0);
  --secondary: oklch(0.9622 0.0035 219.5331);
  --secondary-foreground: oklch(0.1884 0.0128 248.5103);
  --muted: oklch(0.2090 0 0);
  --muted-foreground: oklch(0.5637 0.0078 247.9662);
  --accent: oklch(0.1928 0.0331 242.5459);
  --accent-foreground: oklch(0.5857 0.2236 31.4889);
  --destructive: oklch(0.5857 0.2236 31.4889);
  --destructive-foreground: oklch(1.0000 0 0);
  --border: oklch(0.2674 0.0047 248.0045);
  --input: oklch(0.3020 0.0288 244.8244);
  --ring: oklch(0.5857 0.2236 31.4889);
  --chart-1: oklch(0.6723 0.1606 244.9955);
  --chart-2: oklch(0.6907 0.1554 160.3454);
  --chart-3: oklch(0.8214 0.1600 82.5337);
  --chart-4: oklch(0.7064 0.1822 151.7125);
  --chart-5: oklch(0.5919 0.2186 10.5826);
  --sidebar: oklch(0.2097 0.0080 274.5332);
  --sidebar-foreground: oklch(0.8853 0 0);
  --sidebar-primary: oklch(0.5857 0.2236 31.4889);
  --sidebar-primary-foreground: oklch(1.0000 0 0);
  --sidebar-accent: oklch(0.1928 0.0331 242.5459);
  --sidebar-accent-foreground: oklch(0.5857 0.2236 31.4889);
  --sidebar-border: oklch(0.3795 0.0220 240.5943);
  --sidebar-ring: oklch(0.5857 0.2236 31.4889);
  --font-sans: Open Sans, ui-sans-serif, sans-serif, system-ui;
  --font-serif: Noto Serif, ui-serif, serif;
  --font-mono: IBM Plex Mono, ui-monospace, monospace;
  --radius: 1.3rem;
  --shadow-2xs: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00);
  --shadow-xs: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00);
  --shadow-sm: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00), 0px 1px 2px -1px hsl(202.8169 89.1213% 53.1373% / 0.00);
  --shadow: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00), 0px 1px 2px -1px hsl(202.8169 89.1213% 53.1373% / 0.00);
  --shadow-md: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00), 0px 2px 4px -1px hsl(202.8169 89.1213% 53.1373% / 0.00);
  --shadow-lg: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00), 0px 4px 6px -1px hsl(202.8169 89.1213% 53.1373% / 0.00);
  --shadow-xl: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00), 0px 8px 10px -1px hsl(202.8169 89.1213% 53.1373% / 0.00);
  --shadow-2xl: 0px 2px 0px 0px hsl(202.8169 89.1213% 53.1373% / 0.00);
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-destructive-foreground: var(--destructive-foreground);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
  --color-chart-1: var(--chart-1);
  --color-chart-2: var(--chart-2);
  --color-chart-3: var(--chart-3);
  --color-chart-4: var(--chart-4);
  --color-chart-5: var(--chart-5);
  --color-sidebar: var(--sidebar);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-ring: var(--sidebar-ring);

  --font-sans: var(--font-sans);
  --font-mono: var(--font-mono);
  --font-serif: var(--font-serif);

  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);

  --shadow-2xs: var(--shadow-2xs);
  --shadow-xs: var(--shadow-xs);
  --shadow-sm: var(--shadow-sm);
  --shadow: var(--shadow);
  --shadow-md: var(--shadow-md);
  --shadow-lg: var(--shadow-lg);
  --shadow-xl: var(--shadow-xl);
  --shadow-2xl: var(--shadow-2xl);
}

---

## 4. План разработки (бэклог)

### Эпик 1: Базовая Инфраструктура и Среда (Спринт 1)
**Цель:** Запуск среды разработки, настройка базы данных, базовый фреймворк и адаптивный макет.
| Задача | Описание | Приоритет | Стек/Требование |
| :--- | :--- | :--- | :--- |
| **1.1. Настройка Проекта** | Инициализация Next.js с TypeScript. Настройка ESLint, Prettier. | 🥇 Критический | Next.js, TypeScript |
| **1.2. Настройка БД и ORM** | Настройка PostgreSQL и Prisma. Написание первой миграции. | 🥇 Критический | PostgreSQL, Prisma |
| **1.3. Настройка Стилизации** | Интеграция Tailwind CSS и shadcn/ui. Настройка адаптивного макета (Mobile-First). | 🥇 Критический | Tailwind CSS, shadcn/ui (Адаптивный дизайн) |
| **1.4. Система Аутентификации (База)** | Настройка NextAuth.js. Реализация входа по **Email/пароль** и **Google OAuth**. Подтверждение email. | 🥇 Критический | NextAuth.js (Email+пароль, Google) |
| **1.5. Ролевая Модель** | Создание базовых ролей: **Пользователь, Автор, Админ** (для системы авторизации). | 🥇 Критический | Next.js API Routes / Server Actions |
| **1.6. Развертывание (Dev/Staging)** | Настройка Docker/Docker Compose для локальной разработки и первого тестового деплоя. | 🥈 Высокий | Docker, PostgreSQL |

### Эпик 2: Ядро Маршрутов и Каталог (Спринт 2)
**Цель:** Создание основной структуры данных для маршрутов, реализация главной страницы с каталогом и фильтрацией.
| Задача | Описание | Приоритет | Стек/Требование |
| :--- | :--- | :--- | :--- |
| **2.1. Схема БД для Маршрутов** | Определение схемы для маршрутов (название, описание, автор, сложность, длина, длительность, статус). | 🥇 Критический | Prisma, PostgreSQL |
| **2.2. Карточка Маршрута (Главная)** | Разработка компонента карточки маршрута с превью-изображением, названием, рейтингом и тегами "для кого подходит" (пешком, вело и т.д.). | 🥇 Критический | Next.js (SSR/SSG), shadcn/ui |
| **2.3. Страница Каталога (Главная)** | Разработка главной страницы с отображением карточек маршрутов. Без карты! | 🥇 Критический | Next.js, Требование: На главной только карточки |
| **2.4. Основная Фильтрация** | Реализация фильтрации на главной странице по **сложности, длине, длительности** и тегам **«для кого подходит»**. | 🥇 Критический | Next.js, Next.js API, Фильтры: Сложность, Длина, Длительность, Подходит для |
| **2.5. Живой Поиск** | Интеграция PostgreSQL Full-Text Search для **живого поиска** по названию, тексту и тегам. | 🥇 Критический | PostgreSQL Full-Text Search, Next.js API, Живой поиск |

### Эпик 3: Просмотр Маршрута и Карта (Спринт 3)
**Цель:** Реализация страницы просмотра маршрута со всей информацией, динамической картой и функциями скачивания/печати.
| Задача | Описание | Приоритет | Стек/Требование |
| :--- | :--- | :--- | :--- |
| **3.1. Страница Просмотра Маршрута (Дизайн)** | Создание макета для детальной страницы маршрута. | 🥇 Критический | shadcn/ui |
| **3.2. Рендеринг Описания** | Отображение длинного описания, форматированного в **Markdown**. | 🥇 Критический | React-Markdown, Markdown-формат |
| **3.3. Блоки Информации** | Реализация отдельных полей для «как добраться», «как уехать», «интересные факты», «риски, предупреждения» (например, клещи). | 🥇 Критический | Свободный текст, Отдельные поля |
| **3.4. Динамическая Карта** | Интеграция Leaflet/MapLibre GL JS для отображения трека и **точек интереса (POI)** внутри карточки маршрута. Использование **OSM-тайлов**. | 🥇 Критический | Leaflet/MapLibre GL JS, OSM-тайлы |
| **3.5. Скачивание Трека** | Реализация кнопки **«скачать трек»** с поддержкой экспорта в **GPX, KML, GeoJSON**. | 🥇 Критический | Экспорт GPX, KML, GeoJSON |
| **3.6. Печать в PDF** | Реализация функции **печати маршрута в PDF** (без оффлайн-режима). | 🥇 Критический | `html-pdf-node`, Печать в PDF |

### Эпик 4: Создание и Управление Маршрутами (Спринт 4)
**Цель:** Создание админ-панели для редакторов, реализация загрузки треков и модерации медиа.
| Задача | Описание | Приоритет | Стек/Требование |
| :--- | :--- | :--- | :--- |
| **4.1. Админка (Скелет)** | Создание встроенной в сайт админ-панели. Разделы: Маршруты, Треки, Пользователи, Комментарии. | 🥇 Критический | shadcn/ui, Роль: Админ |
| **4.2. Форма Создания Маршрута** | Создание формы для редакторов с полями: название, описание (Markdown), фильтры, информация о транспорте, риски. Поддержка **черновика** и **предпросмотра**. | 🥇 Критический | Роль: Редактор, Черновик/Предпросмотр |
| **4.3. Загрузка и Конвертация Треков** | Реализация загрузки файлов **GPX, KML, GeoJSON** (и опционально FIT). Серверный парсинг и конвертация в унифицированный GeoJSON для хранения. | 🥇 Критический | `togeojson`/`gpx-js`, GPX/KML/GeoJSON |
| **4.4. Обработка Фото** | Реализация загрузки фото. Автоматическое **сжатие** и **изменение размера** (до 1920px, до 3 МБ). | 🥇 Критический | Sharp, Фото до 3 МБ/1920px |
| **4.5. Генерация Превью-Картинки** | Серверная генерация превью-картинок (линия трека на карте) в едином стиле для карточек и соцсетей. | 🥇 Критический | Node-Canvas/Puppeteer, Превью-картинка |
| **4.6. Точки Интереса (CRUD)** | Реализация добавления/редактирования **точек интереса (POI)** (виды, вода, кафе, туалеты, транспорт) с иконками в админке. | 🥈 Высокий | Иконки для POI |
| **4.7. Поддержка Нескольких Авторов** | Реализация возможности назначать несколько авторов для одного маршрута. | 🥈 Высокий | Next.js API, Несколько авторов |

### Эпик 5: Социальные Функции и SEO (Спринт 5)
**Цель:** Добавление системы комментариев, рейтингов и обязательная поисковая оптимизация.
| Задача | Описание | Приоритет | Стек/Требование |
| :--- | :--- | :--- | :--- |
| **5.1. Рейтинг и Оценка** | Реализация системы **оценок/рейтингов** маршрута (отдельно от комментариев). | 🥇 Критический | Next.js API |
| **5.2. Система Комментариев (CRUD)** | Реализация формы и отображения комментариев. Поддержка **веток/ответов**. | 🥇 Критический | Next.js API, Ветвление, Ответы |
| **5.3. Модерация Комментариев** | Админ-функция для модерации, **антиспам**, возможность **пожаловаться**. Ограничение ссылок (только как текст). | 🥇 Критический | Роль: Админ, Модерация, Антиспам |
| **5.4. Уведомления** | Уведомления для авторов (о новых комментариях к их маршруту или о модерации). | 🥈 Высокий | Next.js API, Уведомления |
| **5.5. SEO-Оптимизация** | Настройка **JSON-LD**, **Open Graph** метатегов (используя сгенерированное превью) и **человекопонятных URL (ЧПУ)** латиницей. | 🥇 Критический | Next.js (SEO), JSON-LD, ЧПУ, Шаринг |
| **5.6. Кнопки Шеринга** | Добавление кнопок для шеринга в соцсетях. | 🥈 Высокий | Шеринг |

### Эпик 6: Финализация и Запуск (Спринт 6)
**Цель:** Внедрение обязательных юридических документов, аналитики и финальная подготовка к запуску в Томске.
| Задача | Описание | Приоритет | Стек/Требование |
| :--- | :--- | :--- | :--- |
| **6.1. Юридические Страницы** | Создание страниц: Правила, Политика приватности, Отказ от ответственности. | 🥇 Критический | Юридические документы |
| **6.2. Баннер Cookies** | Внедрение баннера о куки. | 🥇 Критический | Cookies |
| **6.3. Страница «Поддержать проект»** | Разработка статической страницы. | 🥈 Высокий | Поддержать проект |
| **6.4. Интеграция Аналитики** | Внедрение счетчиков **Яндекс.Метрика** и **Google Analytics**. | 🥇 Критический | Яндекс.Метрика, Google Analytics |
| **6.5. Аудит-лог** | Внедрение системы логирования действий (кто, что изменил) для админки. | 🥈 Высокий | Аудит-лог |
| **6.6. Финальное Тестирование** | Комплексное тестирование функционала и адаптивного дизайна на всех устройствах. Загрузка тестового контента. | 🥇 Критический | Все устройства, MVP готов |